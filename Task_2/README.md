# Task 2: Named Entity Recognition and Image Classification

This project implements a verification pipeline that combines NER (Named Entity Recognition) and image classification to determine if a textual claim about a monkey species matches what appears in an image.

## Overview

I chose a dataset where I needed to classify 10 species of monkeys. First, I tried to implement an NER model in the classical way. However, the model barely learned and almost always indicated that the text didn't mention any of the species. Therefore, I decided to create a transformer classifier that would necessarily select one of the monkey species in the result. For the image classification model, I used a standard CNN architecture and achieved 75% accuracy. The result could have been improved by adding several layers, but I didn't have enough computational resources for a full training.

For training NER model I used generated by Claude from Anthropic monkey_ner_dataset.json

## Project Structure

```
Task_2/
├── data/
│   └── monkey_species/               # Directory containing monkey image dataset
│   └── monkey_ner_dataset.json       # NER dataset for monkey species
├── model/                            # Trained NER model
├── monkey_classifier/                # Trained text classification model
├── notebooks/
│   ├── monkeys_classification.ipynb  # CNN model
├── scripts/
│   ├── prepare_data.py               # Data preparation for NER
│   ├── train_model.py                # NER model training
│   ├── train_classifier.py           # Text classifier training
│   ├── test_model.py                 # Test script for NER model
│   ├── test_classifier.py            # Test script for text classifier
│   └── pipeline.py                   # Complete verification pipeline
├── best_monkey_model.h5              # Trained image classification model
├── class_mapping.json                # Mapping from class indices to species names
└── requirements.txt                  # Required Python packages
```

## Solution Overview

The verification pipeline consists of two main components:

1. **Text Processing**: A BERT-based classifier that identifies which monkey species is mentioned in the text.
2. **Image Classification**: A CNN model that identifies which monkey species appears in the image.

The pipeline compares these two predictions to determine if the text claim matches the image content.

## Installation

1. Create a virtual environment:
```bash
python -m venv .venv
```

2. Activate the virtual environment:
```bash
# Windows
.venv\Scripts\Activate.ps1
# Linux/macOS
source .venv/bin/activate
```

3. Install dependencies:
```bash
pip install -r requirements.txt
```

## Usage

### Running the Complete Pipeline

The complete verification pipeline can be run with:

```bash
python scripts/pipeline.py \
  --text_model_dir monkey_classifier \
  --image_model_path best_monkey_model.h5 \
  --class_mapping class_mapping.json \
  --text "I saw a japanese macaque in the hot spring" \
  --image "path/to/your/image.jpg"
```

The pipeline will output:
- The species prediction from the text
- The species prediction from the image
- Whether these predictions match (True/False)

### Training the Models

#### Text Classifier

The text classifier can be trained with:

```bash
python scripts/train_classifier.py \
  --data_file data/monkey_ner_dataset.json \
  --output_dir monkey_classifier
```

#### Image Classifier

The image classifier was trained using a CNN architecture on the monkey species dataset. The trained model is saved as `best_monkey_model.h5`.

## Models

### Text Classification Model

The text classification model is based on BERT (`bert-base-uncased`) and is fine-tuned to classify text into one of the monkey species categories. It achieves high accuracy in identifying monkey species mentions.

### Image Classification Model

The image classification model is a CNN with the following architecture:

```
_________________________________________________________________
 Layer (type)                Output Shape              Param #
=================================================================
 conv2d_12 (Conv2D)          (None, 222, 222, 32)      896
 max_pooling2d_12            (None, 111, 111, 32)      0
 conv2d_13 (Conv2D)          (None, 109, 109, 64)      18496
 max_pooling2d_13            (None, 54, 54, 64)        0
 conv2d_14 (Conv2D)          (None, 52, 52, 128)       73856
 max_pooling2d_14            (None, 26, 26, 128)       0
 flatten_4 (Flatten)         (None, 86528)             0
 dense_8 (Dense)             (None, 512)               44302848
 dropout_7 (Dropout)         (None, 512)               0
 dense_9 (Dense)             (None, 10)                5130
=================================================================
Total params: 44,401,226
```

The model is trained to identify 10 different monkey species with high accuracy.

## Supported Monkey Species

The system supports the following monkey species:
- Mantled Howler
- Patas Monkey
- Bald Uakari
- Japanese Macaque
- Pygmy Marmoset
- White Headed Capuchin
- Silvery Marmoset
- Common Squirrel Monkey
- Black Headed Night Monkey
- Nilgiri Langur
